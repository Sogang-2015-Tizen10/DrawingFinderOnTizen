<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=360, user-scalable=no">
    <meta name="description" content="Simple Touch Paint - TouchEvents Tutorial"/>

    <title>DrawImageFinder</title>

    <link rel="stylesheet" type="text/css" href="css/style.css"/>
    <link href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.9.1/themes/smoothness/jquery-ui.css" type="text/css" rel="stylesheet" />
</head>
<body>
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
	<script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.9.1/jquery-ui.min.js"></script>
	<script src="js/jquery.imgsimilarity.js"></script>
	
	    <header style="background-color:gray">
	    	
				<!--  	<img src="http://cspro.sogang.ac.kr/~cse20131570/table.png" style="width: 110px; height: 110px;">
			        <img src="http://cspro.sogang.ac.kr/~cse20131570/table.png" style="width: 110px; height: 110px;">
			        <img src="http://cspro.sogang.ac.kr/~cse20131570/table.png" style="width: 110px; height: 110px;">	
				-->
	        <div>
					<div id="results"></div>
			</div>
	    </header>
	    
	    
	    
	    <section class="content">
	  		 <canvas class="canvas" id="canvas_id">
				This browser is not supported
			</canvas>
			
		</section>
			   	
	    
	    <footer>
	    	<div>
				<div id="catalog"></div>
			</div>
	        <div class="color-option">
	            <div class="option-frame">
	                <p>Color</p>
	                <input type="color" class="color-input">
	            </div>
	        </div>
	        <div class="range-option">
	            <div class="option-frame">
	                <p>Line width</p>
	                <input type="range" min="5" max="30" value="5" class="range-input">
	            </div>
	        </div>
	        <!--
	        <div class="clear-option">
	            <div class="option-frame">
	                <p>Clear</p>
	                <input type="button" class="clear-input" value=" ">
	            </div>
	        </div> 
	        -->
	        <div class="save-option">
	        	<div class="option-frame">
	                <a id=convert-img>Save</a>
	                <!--  <input type="button" class="convert-img" value=" " >  -->
	            </div>
	        </div>
	    </footer>
	<!-- 
	<div id="logindiv">
		<form id="logindiv_form">
			  Username: <input type="text" id="username" name="username"><br>
			  Password: <input type="password" id="password" name="password"><br>
	 	 	<input type="submit" value="Submit">
		</form>
	</div>-->
    <script>
    var baseDirectory = "http://cspro.sogang.ac.kr/~cse20131570/img/";
	var catalogImages = ["korea_my.png", "02.jpg", "03.jpg", "korea.png",
	"01.jpg", "japan.png"/*, "japan_my.png"*/, "redball.png", "te.png", "ne.png", "usa.png"];

	$(document).ready(function()
	{
		/*$("#divisor").text(100);
		$("#recompute").button().click(function()
		{
			recomputeMatches();
		});*/

		/*var slider = $("#threshold").slider({
			max: 500,
			slide: function(event, ui){
				$("#thresholdvalue").text(ui.value);
				recomputeMatches();
			}
		});*/

		//$("#thresholdvalue").text($("#threshold").slider("value"));

		//$("#thresholdvalue").text(200);

		var catalog = $("#catalog");
		var results = $("#results");

		$.each(catalogImages, function(index, value) {
		//Build up images and have them automatically calculate their
		//similarity information.
			
			var image = comparableImage(baseDirectory + value
				//"http://cspro.sogang.ac.kr/~cse20131570/table.png"
				, value);
			console.log(value);
			//if(index>0){
				catalog.append(image);
			//}
				//jQuery UI Accordion to show results
				//results.append($("<h3/>").text(value + "'s similar images"));
			if(index==0){
				matches = $("<div/>").addClass("matches").attr("id", "match"+index);

				results.append(matches);
			}
		});
		/*var image = comparableImage(//baseDirectory + value
			"http://cspro.sogang.ac.kr/~cse20131570/table.png"
			, "none");
			catalog.append(image);
		results.append($("<h3/>").text("'s similar images"));
		matches = $("<div/>").addClass("matches").attr("id", "match");

		results.append(matches);
*/

		//results.accordion({ autoHeight: false, clearStyle: true});

	});

	function comparableImage(url, title)
	{
		//Given a URL return a created img element. The image will
		//automatically calculate its similarity histogram once its data is
		//loaded. Then, matches will be recomputed because there is a new
		//loaded image.
		var element = $("<img/>");
		element.attr("alt", title);
		element.attr("title", title);

		//console.log(this);

		element.load(function() {
			//When the image loads, automatically calculate image
			//comparison information.
			$(this).imgSimilarity();
			recomputeMatches();
		});

		element.attr("src", url);

		return element;
	}

	function recomputeMatches()
	{
		//var threshold = parseInt($("#thresholdvalue").text())/parseInt($("#divisor").text());
		var threshold = 5;

		var allData = $("#catalog img").map(function(index, element) {
			return $(element);
		});

		allData = $.grep(allData, function(element)
		{
			//Has loaded histogram information.
			return typeof (element.data('imgSimilarity')) !== "undefined";
		});


		//console.log(allData);

		//algorithm could be slightly improved by not reexamining pairs.
		for (var i = 0; i < 1; i++)
		{
			var matches = new Array();

			var matchData = allData[i].data('imgSimilarity').findClosest(allData);
			//Find appropriate div to list our matches.
			var container = $("#match" + i);
			//Remove existing results, we're building up new results next.
			container.empty();

			for (var j = 0; j < matchData.length; j++)
			{
				//Close enough!
				if (matchData[j] <= threshold)
				{
					var matchImg = $("<img/>");
					matchImg.attr('src', allData[j].attr('src'));
					matches.push({  amount: matchData[j], 
						img: matchImg, 
						data: allData[j].data('imgSimilarity')
					});
				}

				//Sort by closest matches first.
				matches.sort(function(a,b) { return a.amount - b.amount; });

				$.each(matches, function(index, element) {
					//Show each match.
					container.append(element.img);
					var similarityInfo = "Similarity: " + element.amount.toFixed(4);

					element.img.attr("title", similarityInfo);
				});
			}
		}
	}
	</script> 
	<!--  <script>
	/*	$(document).ready(readyCb);
		function readyCb() {
			$('#logindiv_form').on('submit', login);
		}
		function login(){
			var username=$("input#username").val().trim();
			var passwd=$("input#password").val().trim();
			alert(username+" "+passwd);
			$.ajax({
	        	url: 'http://cspro.sogang.ac.kr/~cse20131570/cgi-bin/login.php',
	        	method: 'POST',
	        	data: {
	        		user_id : username,
	        		user_passwd : passwd
	        	}
	        }).done(function(res) {
	        	if(res=='success'){
		        	$('#logindiv_form').addClass('login_ok');
					// push catalogImages;
		        }
	        	else{
					// retry
					alert("false");
		        }
	        	alert(res);
	        });
		}*/
	</script>-->
	<script src="js/main.js"></script> 
    <!--  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
    <script src="js/main.js"></script>
    <script src="js/jquery.imgsimilarity.js"></script>-->

</body>
</html>
